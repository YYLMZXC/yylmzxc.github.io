# 实现TCP、UDP和Ping三种延迟检测功能

## 目标
在online_server页面上实现三种延迟检测：
1. **Ping延迟** - 使用系统ping命令检测网络延迟
2. **TCP延迟** - 检测TCP连接建立延迟
3. **UDP延迟** - 检测UDP数据包往返延迟

## 实现步骤

### 1. 完善/创建延迟检测脚本

#### 1.1 完善 `ping_server.php`
- 基于现有 `tcp_server.php` 代码，提取并简化为专门的ping检测脚本
- 仅使用系统ping命令检测延迟
- 返回JSON格式结果

#### 1.2 创建 `udp_server.php`
- 实现UDP延迟检测功能
- 使用 `socket_create` 和 `socket_sendto`/`socket_recvfrom` 实现UDP ping
- 支持超时处理和错误检测
- 返回JSON格式结果

### 2. 修改前端页面 `online_server.php`

#### 2.1 更新服务器显示结构
- 在每个服务器项中添加三个延迟显示区域
- 分别显示Ping延迟、TCP延迟和UDP延迟
- 为每种延迟添加不同的图标和样式

#### 2.2 更新JavaScript代码
- 修改现有的 `pingServer` 函数，改为调用三个不同的检测端点
- 添加 `tcpServer` 和 `udpServer` 函数
- 更新延迟显示逻辑，支持三种延迟的独立显示和更新
- 为每种延迟添加独立的状态管理和样式

#### 2.3 更新CSS样式
- 添加三种延迟的样式定义
- 为不同延迟值添加颜色区分（低延迟绿色、中延迟黄色、高延迟红色）
- 添加加载状态的动画效果

### 3. 优化检测逻辑

#### 3.1 检测顺序优化
- 并行执行三种延迟检测，提高效率
- 添加检测超时处理，避免单个检测失败影响整体
- 实现检测结果缓存，减少重复检测

#### 3.2 错误处理
- 为每种检测添加详细的错误信息
- 显示检测失败的原因
- 支持重试机制

## 技术实现要点

### UDP延迟检测实现
- 使用PHP的socket扩展实现UDP ping
- 发送UDP数据包到目标服务器的常用端口
- 计算数据包往返时间
- 处理超时和网络错误

### 前端优化
- 使用异步XMLHttpRequest或Fetch API进行检测
- 实现检测结果的实时更新
- 添加响应式设计，适配不同屏幕尺寸
- 优化用户体验，添加加载动画和结果反馈

## 文件修改清单

1. `online_server.php` - 更新前端页面显示和JavaScript逻辑
2. `ping_server.php` - 实现Ping延迟检测
3. `udp_server.php` - 实现UDP延迟检测
4. 相关CSS文件 - 添加新的样式定义

## 预期效果

- 每个服务器项将显示三种延迟结果
- 延迟值将实时更新，带有颜色区分
- 支持检测失败的错误提示
- 优化的检测性能，减少服务器负载
- 良好的用户体验，带有加载状态和结果反馈